# 📚📌4. (중요) 동적 데이터 전송 (0x00 0x04 Send dynamic data)

클라이언트가 **직접 인쇄할 콘텐츠(텍스트, 이미지 등)** 를 프린터에 전송할 때 사용하는 명령어이다.
**1물 1코드(제품마다 다른 QR코드)** 인쇄에 최적화된 방식이다.

---

## ✅ 주요 특징

- **직접 인쇄 데이터 전송 가능** (텍스트, 이미지 포함)
    
- **JSON + 바이너리 전송** 조합
    
- **압축 전송 지원** (속도 향상)
    
- `repeat_times: 1` 설정으로 **즉시 다음 데이터 전환 가능**
    
- **QR코드 같은 가변 이미지 출력에 최적**

---

## 📨 요청 구조 (Request)

### 1. 프로토콜 구성

|구분|값|
|---|---|
|헤더|`0xEB 0x01`|
|프로토콜 마크|`0x00 0x04`|
|데이터 길이|4바이트 (`JSON 문자열 + \0` 포함)|
|데이터 내용|UTF-8 인코딩 JSON 문자열 + 종료 문자 `\0`|
|(옵션) 이미지 데이터|압축된 바이너리 형태로 JSON 뒤에 추가|

---

## 🧾 JSON 구조 예시


```json
{
  "text": [
    {
      "metaname": "img1",
      "is_image": 1,
      "metadata_pos": 0,
      "metadata_len": 18494,
      "hide_flag": 0,
      "metaimage_dpi": 300,
      "metaimage_has_rolate": 0,
      "compress": 0
    },
    {
      "metaname": "txt",
      "is_image": 0,
      "metadata": "12321321",
      "hide_flag": 0
    }
  ],
  "repeat_times": 1,
  "app_mode": 1000,
  "direct": -1,
  "cover_flag": 0,
  "hide_flag": 0
}

```

---

## 🔍 주요 파라미터 설명

### ✅ 텍스트 / 이미지 공통 필드 (`text` 배열 내부)

|항목|설명|
|---|---|
|`metaname`|데이터 이름 (`"img1"`, `"txt"` 등)|
|`is_image`|1: 이미지 / 0: 텍스트|
|`hide_flag`|1: 출력에서 숨김 / 0: 출력|

### ✅ 이미지 전용 필드

|항목|설명|
|---|---|
|`metadata_pos`|전체 이미지 데이터에서 시작 위치|
|`metadata_len`|이미지 데이터 길이 (바이트 단위)|
|`metaimage_dpi`|해상도(DPI), 0~1200|
|`metaimage_has_rolate`|회전 각도 (0~360도)|
|`compress`|1: 압축 사용 / 0: 압축 안 함|

### ✅ 텍스트 전용 필드

|항목|설명|
|---|---|
|`metadata`|실제 텍스트 내용|

### ✅ 전송 제어 필드 (JSON 루트)

|항목|설명|
|---|---|
|`repeat_times`|인쇄 횟수 (1 = 1회 출력 후 다음 데이터로 전환)|
|`app_mode`|현재 앱 모드 (예: 1000)|
|`direct`|인쇄 방향 (-1: 없음, 0: 좌→우, 1: 우→좌)|
|`cover_flag`|0: 덮어쓰기 안 함 / 1: 덮어쓰기 수행|
|`hide_flag`|전체 동적 데이터 소스를 숨길지 여부|

---

## 📦 이미지 압축 처리

- `compress: 1`로 설정 시, **압축 필수**
    
- C++ 함수 `ym_bmp_rlecompress` 사용
    
- 압축된 바이너리 데이터는 JSON 뒤에 **붙여 전송**

---

## 📥 응답 구조 (Response)

```json
{   "status": 0 }
```

|status|설명|
|---|---|
|0|성공|
|1|실패|
|49|동적 소스 DB 캐시 초과|
|50|인쇄 시작되지 않음|
